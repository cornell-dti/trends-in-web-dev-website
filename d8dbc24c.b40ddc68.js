(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{131:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return p}));var a=n(3),o=n(7),r=(n(0),n(142)),c={id:"lecture8",title:"Lecture 8"},i={unversionedId:"lecture8",id:"version-2021sp/lecture8",isDocsHomePage:!1,title:"Lecture 8",description:"Lecture Slides",source:"@site/versioned_docs/version-2021sp/lecture8.md",slug:"/lecture8",permalink:"/docs/2021sp/lecture8",version:"2021sp",sidebar:"docs",previous:{title:"Lecture 7",permalink:"/docs/2021sp/lecture7"},next:{title:"Lecture 9",permalink:"/docs/2021sp/lecture9"}},s=[{value:"Concurrently",id:"concurrently",children:[]},{value:"Bridging the Frontend &amp; Backend",id:"bridging-the-frontend--backend",children:[]},{value:"Data Fetching",id:"data-fetching",children:[{value:"What IS data fetching?",id:"what-is-data-fetching",children:[]},{value:"How do we fetch (in React)?",id:"how-do-we-fetch-in-react",children:[]},{value:"Fetching Example",id:"fetching-example",children:[]}]},{value:"<code>fetch</code>",id:"fetch",children:[]},{value:"Promises",id:"promises",children:[{value:"<code>.then()</code>",id:"then",children:[]},{value:"<code>.catch()</code>",id:"catch",children:[]},{value:"Using <code>.then()</code> with <code>fetch()</code>",id:"using-then-with-fetch",children:[]},{value:"async/await",id:"asyncawait",children:[]},{value:"I still don&#39;t understand Promises",id:"i-still-dont-understand-promises",children:[]}]},{value:"What if I don&#39;t like <code>fetch</code>? \ud83d\ude29",id:"what-if-i-dont-like-fetch-",children:[]},{value:"CORS workaround: proxy",id:"cors-workaround-proxy",children:[]},{value:"Summary",id:"summary",children:[]},{value:"Demo Code",id:"demo-code",children:[{value:"Backend",id:"backend",children:[]}]}],l={toc:s};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.google.com/presentation/d/13kdvV_IpDryZ0hh5GT73-ysfX7YUfbIWdubEJIEmFao/edit?usp=sharing"}),"Lecture Slides")),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://drive.google.com/file/d/1YoTS9HenT6w_K4LKZF9r_FOlqh4zhWvi/view?usp=sharing"}),"Lecture Video")),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/2021sp/finalproject#milestone-1"}),"Final Project - Milestone 1 now due 4/27 3:59 PM (Wellness Days)")),Object(r.b)("h2",{id:"concurrently"},"Concurrently"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"concurrently")," npm package lets us run multiple commands concurrently, as\nthe name suggests. This is perfect for us since we want to run both the backend\nand the frontend at the same time!"),Object(r.b)("p",null,"You can install and add ",Object(r.b)("inlineCode",{parentName:"p"},"concurrently")," to ",Object(r.b)("inlineCode",{parentName:"p"},"package.json")," by running\n",Object(r.b)("inlineCode",{parentName:"p"},"yarn install concurrently"),"."),Object(r.b)("p",null,"We can create a ",Object(r.b)("inlineCode",{parentName:"p"},"backend")," folder as well as a ",Object(r.b)("inlineCode",{parentName:"p"},"frontend")," folder which contain\nthe corresponding projects."),Object(r.b)("p",null,"Then, you can set up your scripts in your ",Object(r.b)("inlineCode",{parentName:"p"},"package.json")," like so:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json",metastring:'title="package.json"',title:'"package.json"'}),'{\n  "name": "demo",\n  // ...other stuff\n  "scripts": {\n    "server": "cd backend && yarn start",\n    "frontend": "cd frontend && yarn start",\n    "start": "concurrently \\"yarn server\\" \\"yarn frontend\\" "\n  }\n}\n')),Object(r.b)("p",null,"Running ",Object(r.b)("inlineCode",{parentName:"p"},"yarn start")," would use ",Object(r.b)("inlineCode",{parentName:"p"},"concurrently")," to start both the backend and\nfrontend!"),Object(r.b)("h2",{id:"bridging-the-frontend--backend"},"Bridging the Frontend & Backend"),Object(r.b)("p",null,"We've worked with Express/Firebase on the backend and React on the frontend. So\nfar, we've been learning about them separately. How can we bring both ends\ntogether to make one working product?"),Object(r.b)("h2",{id:"data-fetching"},"Data Fetching"),Object(r.b)("p",null,'"',Object(r.b)("em",{parentName:"p"},"data"),' is the new oil \ud83e\udd11"'),Object(r.b)("h3",{id:"what-is-data-fetching"},"What IS data fetching?"),Object(r.b)("p",null,"Data fetching is ",Object(r.b)("strong",{parentName:"p"},"getting information (data) from an outside source (e.g. REST API)")),Object(r.b)("p",null,"The frontend wants to ",Object(r.b)("strong",{parentName:"p"},"fetch data")," from the backend."),Object(r.b)("p",null,"Frontend tells Backend what it wants.\nBackend sends the appropriate data to Frontend.\nFrontend displays the data to the user!"),Object(r.b)("p",null,"In Trends, our React website will be fetching data from our Express server."),Object(r.b)("h3",{id:"how-do-we-fetch-in-react"},"How do we fetch (in React)?"),Object(r.b)("p",null,"So how do we fetch data with our React frontend?"),Object(r.b)("p",null,"Two important things to note:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Modern browsers have a nifty little JavaScript function called ",Object(r.b)("inlineCode",{parentName:"p"},"fetch")," that\nyou can use to call API endpoints. Libraries such as ",Object(r.b)("inlineCode",{parentName:"p"},"axios")," provide similar\nfunctionality.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"The ",Object(r.b)("inlineCode",{parentName:"p"},"useEffect")," React hook allows you to trigger side effects, such as\nfetching data!"))),Object(r.b)("p",null,"We want to keep track of our data in our component state, and use hooks like\n",Object(r.b)("inlineCode",{parentName:"p"},"useEffect")," to ",Object(r.b)("inlineCode",{parentName:"p"},"fetch")," the data and update the state accordingly!"),Object(r.b)("h3",{id:"fetching-example"},"Fetching Example"),Object(r.b)("p",null,"Consider this snippet of code:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'title="App.tsx"',title:'"App.tsx"'}),"// This corresponds to the type of data you get back in your response\ntype DataType = readonly string[];\n\nconst App = () => {\n  const [data, setData] = useState<DataType>([]);\n  useEffect(() => {\n    fetch(`${API}`)\n      .then((response) => response.json())\n      .then((d) => setData(d));\n  });\n  // ... other methods, return, etc\n};\n")),Object(r.b)("p",null,"Here are the important parts:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"We have ",Object(r.b)("inlineCode",{parentName:"li"},"data")," in our component state. Later, we call ",Object(r.b)("inlineCode",{parentName:"li"},"setData")," on what the\nbackend sends to us."),Object(r.b)("li",{parentName:"ul"},"We declare a type definition for the ",Object(r.b)("inlineCode",{parentName:"li"},"useState")," call so that TS knows the type\nof data we're working with. (It can't infer type from an empty array!)"),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("inlineCode",{parentName:"li"},"useEffect")," hook is used to subscribe to new data."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"fetch(...)")," is called on an API link, followed by ",Object(r.b)("inlineCode",{parentName:"li"},".then(...)")," calls that\nformat the response into json and then ",Object(r.b)("inlineCode",{parentName:"li"},"setData")," to the response. The\n",Object(r.b)("inlineCode",{parentName:"li"},".then()")," calls exist because ",Object(r.b)("inlineCode",{parentName:"li"},"fetch()")," returns a ",Object(r.b)("inlineCode",{parentName:"li"},"Promise")," (this is explained\nbelow)")),Object(r.b)("p",null,"Let's take a deeper look at ",Object(r.b)("inlineCode",{parentName:"p"},"fetch"),"!"),Object(r.b)("h2",{id:"fetch"},Object(r.b)("inlineCode",{parentName:"h2"},"fetch")),Object(r.b)("p",null,'"stop trying to make fetch happen \ud83d\udc67"'),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"fetch(resource, [init])")," is a native browser function for making web requests."),Object(r.b)("p",null,"Its params are:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"resource"),": URL of the site you are fetching from"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"init"),": optional object containing any custom settings you want to apply to\nthe request.")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"    // your init object might look like this\n    {\n      // HTTP request method\n       method: 'GET', // | 'POST' | 'PUT' | 'DELETE' | etc\n       // Any request headers you want to add\n       headers: {\n         'content-type': 'application/json'\n       },\n       // Request body (remember to stringify!)\n       body: JSON.stringify(requestBody)\n       // ... other settings\n    }\n")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"For more on the init object, refer to\n",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch"}),"this link"),"!")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"IMPORTANT: fetch() returns a PROMISE!")),Object(r.b)("h2",{id:"promises"},"Promises"),Object(r.b)("p",null,"Operations like web requests don't complete instantly! You want to do other stuff\nwhile the operation is still going on."),Object(r.b)("p",null,"Promises represent the ",Object(r.b)("strong",{parentName:"p"},"eventual")," completion (or failure) of an async operation."),Object(r.b)("p",null,"Promises are in one of three possible states:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"pending"),": initial state; neither fulfilled nor rejected"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"fulfilled"),": operation completed successfully"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"rejected"),": operation failed")),Object(r.b)("h3",{id:"then"},Object(r.b)("inlineCode",{parentName:"h3"},".then()")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},".then()")," is a function on Promises that return a promise."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"p.then(onFulfilled[, onRejected])\n")),Object(r.b)("p",null,"Let's break this down!"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"p")," is a Promise."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"onFulfilled")," is the callback function that is run when ",Object(r.b)("inlineCode",{parentName:"li"},"p")," is fulfilled"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"onRejected")," (OPTIONAL) is the callback for when ",Object(r.b)("inlineCode",{parentName:"li"},"p")," is rejected")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"p.then(\n  (value) => {\n    // fulfillment\n  },\n  (reason) => {\n    // rejection\n  }\n);\n")),Object(r.b)("p",null,"Let's talk about types! ",Object(r.b)("inlineCode",{parentName:"p"},"p")," in this case might be ",Object(r.b)("inlineCode",{parentName:"p"},"fetch()"),", which returns the\ntype ",Object(r.b)("inlineCode",{parentName:"p"},"Promise<Response>"),". If so, then ",Object(r.b)("inlineCode",{parentName:"p"},"value")," would have the type ",Object(r.b)("inlineCode",{parentName:"p"},"Response"),".\nThen, if the fulfillment function (which takes in ",Object(r.b)("inlineCode",{parentName:"p"},"value"),") returns type\n",Object(r.b)("inlineCode",{parentName:"p"},"string"),", then the entire expression would be type ",Object(r.b)("inlineCode",{parentName:"p"},"Promise<String>"),"."),Object(r.b)("p",null,"If you've taken CS 3110 or done some functional programming outside of this\nclass/category theory, this might make you think of\nMonads/Applicatives/Functors. The specified behavior for ",Object(r.b)("inlineCode",{parentName:"p"},"Promise"),"s in JS/TS\ndon't exactly follow the laws of what was just listed, but for learning purposes\nit may be helpful to roughly compare the ",Object(r.b)("inlineCode",{parentName:"p"},"then")," function to ",Object(r.b)("inlineCode",{parentName:"p"},"fmap")," or ",Object(r.b)("inlineCode",{parentName:"p"},"bind"),"."),Object(r.b)("p",null,"If you're interested, take a look at this snippet and notice how the types\nbehave:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"// promise: Promise<Response>\nconst promise = fetch('something');\n\n// kindaFunctor: (res: Response) => number\nconst kindaFunctor = (res: Response) => res.status;\n\n// kindaMonad: (res: Response) => Promise<string>\nconst kindaMonad = (res: Response) => res.text();\n\n// newPromise1: Promise<number>\nconst newPromise1 = promise.then(kindaFunctor);\n\n// newPromise2: Promise<string>\nconst newPromise2 = promise.then(kindaMonad);\n")),Object(r.b)("h3",{id:"catch"},Object(r.b)("inlineCode",{parentName:"h3"},".catch()")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},".catch()")," is a function on Promises that catches a rejection."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"p.catch(onRejected);\n")),Object(r.b)("p",null,"For example, you might want to ",Object(r.b)("inlineCode",{parentName:"p"},"console.log")," errors:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"fetch(`https://jsonplaceholder.typicode.com/posts`)\n  .then(...)\n  .catch((err) => console.log(err))\n")),Object(r.b)("p",null,"Note that ",Object(r.b)("inlineCode",{parentName:"p"},"onRejected")," takes a parameter of type ",Object(r.b)("inlineCode",{parentName:"p"},"any"),", since we don't know the\ntype of the error we will get."),Object(r.b)("h3",{id:"using-then-with-fetch"},"Using ",Object(r.b)("inlineCode",{parentName:"h3"},".then()")," with ",Object(r.b)("inlineCode",{parentName:"h3"},"fetch()")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"fetch()")," returns a ",Object(r.b)("inlineCode",{parentName:"p"},"Promise")," that resolves to a ",Object(r.b)("inlineCode",{parentName:"p"},"Response")," object."),Object(r.b)("p",null,"Consider this snippet, similar to one shown above:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"fetch(`https://jsonplaceholder.typicode.com/posts`)\n  .then((response) => response.json())\n  .then((d) => setData(d));\n  .catch((err) => console.log(err))\n")),Object(r.b)("p",null,"Here we are getting the response from an endpoint ",Object(r.b)("strong",{parentName:"p"},"and then")," calling ",Object(r.b)("inlineCode",{parentName:"p"},".json()"),"\non the response ",Object(r.b)("strong",{parentName:"p"},"and then")," calling ",Object(r.b)("inlineCode",{parentName:"p"},"setData")," on the result of ",Object(r.b)("inlineCode",{parentName:"p"},"json()"),"."),Object(r.b)("p",null,"If a promise gets rejected anywhere along this chain, we will log the error in\nour console."),Object(r.b)("h3",{id:"asyncawait"},"async/await"),Object(r.b)("p",null,"If you have too many ",Object(r.b)("inlineCode",{parentName:"p"},".then()")," calls within each other, you might build a\nPYRAMID OF DOOM \u2620."),Object(r.b)("p",null,"Adding the ",Object(r.b)("inlineCode",{parentName:"p"},"async")," keyword to a function designates that function as an\nasynchronous function"),Object(r.b)("p",null,"Within these ",Object(r.b)("inlineCode",{parentName:"p"},"async")," functions we can use await to designate which lines need to\nbe \u201cawaited\u201d upon to resolve"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"// .then\nconst fetchData = () => {\n  fetch(`https://jsonplaceholder.typicode.com/posts`)\n    .then((response) => response.json())\n    .then((d) => setData(d));\n};\n\n// async/await\nconst fetchData = async () => {\n  const response = await fetch('https://jsonplaceholder.typicode.com/posts');\n  const posts = await response.json();\n  setData(posts);\n};\n")),Object(r.b)("h3",{id:"i-still-dont-understand-promises"},"I still don't understand Promises"),Object(r.b)("p",null,"Let's say you are at a store and you want to know whether the store has\nsomething in stock. So you ask an employee named Joe and he ",Object(r.b)("strong",{parentName:"p"},"promises")," you\nthat he'll be back with the results."),Object(r.b)("p",null,"You are now waiting for Joe to come back. The Promise will be ",Object(r.b)("strong",{parentName:"p"},"pending")," for as\nlong as Joe is gone."),Object(r.b)("p",null,"Let's say Joe comes back with the results. Now you know whether the store is in\nstock or not. Now the Promise is ",Object(r.b)("strong",{parentName:"p"},"fulfilled"),"."),Object(r.b)("p",null,"Let's say Joe doesn't come back with the results. Unfortunately an anvil fell on\nhim or something. Now you know that Joe will not come back with the result. Now\nthe Promise is ",Object(r.b)("strong",{parentName:"p"},"rejected"),"."),Object(r.b)("h2",{id:"what-if-i-dont-like-fetch-"},"What if I don't like ",Object(r.b)("inlineCode",{parentName:"h2"},"fetch"),"? \ud83d\ude29"),Object(r.b)("p",null,"Try ",Object(r.b)("inlineCode",{parentName:"p"},"axios")," instead!"),Object(r.b)("p",null,"Axios is an npm package that can give you a better experience fetching data."),Object(r.b)("p",null,"It has methods like:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"axios.get(url[, config])")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"axios.post(url[, data[, config]])")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"axios.put(url[, data[, config]])")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"axios.delete(url[, config])"))),Object(r.b)("p",null,"Axios also returns a promise and can be resolved with ",Object(r.b)("inlineCode",{parentName:"p"},".then()"),"."),Object(r.b)("p",null,"Here's an example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"// fetch()\nconst fetchData = async () => {\n  const response = await fetch('https://jsonplaceholder.typicode.com/posts');\n  const posts = await response.json();\n  setData(posts);\n};\n\n// axios\nconst fetchData = async () => {\n  const posts = await axios.get('https://jsonplaceholder.typicode.com/posts');\n  setData(posts);\n};\n")),Object(r.b)("p",null,"In Typescript you can provide type definitions for the response you'll get from\na request, similar to what we do in ",Object(r.b)("inlineCode",{parentName:"p"},"useState<type>"),". If you don't specify,\nyou'll get the ",Object(r.b)("inlineCode",{parentName:"p"},"any")," type."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"// anyResponse: AxiosResponse<any>\nconst anyResponse = await axios.get('url');\n// anyData: any\nconst anyData = anyResponse.data;\n\ntype DataType = ...;\n// typedResponse: AxiosResponse<DataType>\nconst typedResponse = await axios.get<DataType>('url');\n// typedData: DataType\nconst typedData = typedResponse.data;\n")),Object(r.b)("h2",{id:"cors-workaround-proxy"},"CORS workaround: proxy"),Object(r.b)("p",null,"When you are testing your backend and frontend together on localhost, you will\ncome across some sort of ",Object(r.b)("strong",{parentName:"p"},"CORS policy error")," when you try to call the backend\nfrom the frontend."),Object(r.b)("p",null,"One way to get around this is to add this line to your ",Object(r.b)("strong",{parentName:"p"},"frontend"),"'s\n",Object(r.b)("inlineCode",{parentName:"p"},"package.json"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'  "proxy": "http://localhost:8080",\n')),Object(r.b)("p",null,"where ",Object(r.b)("inlineCode",{parentName:"p"},"8080")," is the the port of your ",Object(r.b)("strong",{parentName:"p"},"backend")," (change it accordingly)."),Object(r.b)("p",null,"After adding the proxy config, remove the base URL from your requests:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"// do this\nconst posts = await axios.get('/getAllPosts');\n\n// instead of this\nconst posts = await axios.get('http://localhost:8080/getAllPosts');\n")),Object(r.b)("h2",{id:"summary"},"Summary"),Object(r.b)("p",null,"You keep track of your data in component state. Your app displays whatever data\nyou have."),Object(r.b)("p",null,"You update your data by calling an endpoint within ",Object(r.b)("inlineCode",{parentName:"p"},"useEffect")," and setting your\ndata to the response that you get back."),Object(r.b)("p",null,"You can call endpoints using ",Object(r.b)("inlineCode",{parentName:"p"},"fetch()")," or ",Object(r.b)("inlineCode",{parentName:"p"},"axios")," and handle the responses\nasynchronously."),Object(r.b)("h2",{id:"demo-code"},"Demo Code"),Object(r.b)("h3",{id:"backend"},"Backend"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript",metastring:'title="index.ts (backend)"',title:'"index.ts','(backend)"':!0}),"import admin from 'firebase-admin';\nimport express from 'express';\n\nconst serviceAccount = require('../service-account.json');\n\nadmin.initializeApp({\n  credential: admin.credential.cert(serviceAccount),\n});\n\nconst db = admin.firestore();\n\nconst app = express();\nconst port = 8080;\napp.use(express.json());\n\ntype Product = {\n  category: string;\n  price: string;\n  stocked: boolean;\n  name: string;\n};\n\ntype ProductWithID = Product & {\n  id: string;\n};\n\nconst productsCollection = db.collection('products');\n\napp.get('/getProducts', async (_, res) => {\n  const products = await productsCollection.orderBy('category').get();\n  res.json(\n    products.docs.map(\n      (doc): ProductWithID => {\n        const product = doc.data() as Product;\n        return { ...product, id: doc.id };\n      }\n    )\n  );\n});\n\napp.post('/createProduct', async (req, res) => {\n  const newProduct: Product = req.body;\n  const addedProduct = await productsCollection.add(newProduct);\n  res.send(addedProduct.id);\n});\n\napp.post('/updatePrice', async (req, res) => {\n  const { id, rating } = req.query;\n  await productsCollection.doc(id as string).update({ rating });\n  res.send('Product updated!');\n});\n\napp.delete('/deleteProduct', async (req, res) => {\n  const { id } = req.query;\n  await productsCollection.doc(id as string).delete();\n  res.send('Product deleted!');\n});\n\napp.listen(port, () => console.log(`Example app listening on port ${port}!`));\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'title="ProductTable.tsx (frontend)"',title:'"ProductTable.tsx','(frontend)"':!0}),"import { ReactElement } from 'react';\n\nexport type Product = {\n  readonly category: string;\n  readonly price: string;\n  readonly stocked: boolean;\n  readonly name: string;\n  readonly id: string;\n};\n\ntype ProductRowProps = {\n  product: Product;\n  products: Product[];\n};\n\n// new code 3\nconst ProductRow = ({ product, products }: ProductRowProps) => {\n  const name = product.stocked ? (\n    product.name\n  ) : (\n    <span style={{ color: 'red' }}>{product.name}</span>\n  );\n\n  // DELETE request using fetch\n  const deleteProduct = () => {\n    fetch(`/deleteProduct?id=${product.id}`, {\n      method: 'DELETE',\n      headers: {\n        'content-type': 'application/json',\n      },\n    });\n  };\n\n  // DELETE request using axios and async/await\n  // const deleteProduct = async () => {\n  //   await axios.delete('/deleteProduct?id=${product.id}');\n  // }\n\n  return (\n    <tr>\n      <td>{name}</td>\n      <td>{product.price}</td>\n      <td>\n        <button onClick={() => deleteProduct()}>delete</button>\n      </td>\n    </tr>\n  );\n};\n\ntype ProductCategoryRowProps = {\n  readonly category: string;\n};\n\nconst ProductCategoryRow = ({ category }: ProductCategoryRowProps) => (\n  <tr>\n    <th colSpan={3}>{category}</th>\n  </tr>\n);\n\ntype Props = {\n  readonly products: Product[];\n  readonly filterText: string;\n  readonly inStockOnly: boolean;\n};\n\nconst ProductTable = ({ products, filterText, inStockOnly }: Props) => {\n  const rows: ReactElement[] = [];\n  let lastCategory: string | null = null;\n\n  products.forEach((product) => {\n    if (product.name.indexOf(filterText) === -1) return;\n    if (inStockOnly && !product.stocked) return;\n    if (product.category !== lastCategory) {\n      rows.push(\n        <ProductCategoryRow\n          category={product.category}\n          key={product.category}\n        />\n      );\n    }\n    rows.push(\n      <ProductRow key={product.name} product={product} products={products} />\n    );\n    lastCategory = product.category;\n  });\n\n  return (\n    <table>\n      <thead>\n        <th>Name</th>\n        <th>Price</th>\n      </thead>\n      <tbody>{rows}</tbody>\n    </table>\n  );\n};\n\nexport default ProductTable;\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'title="FilterableProductTable.tsx (frontend)"',title:'"FilterableProductTable.tsx','(frontend)"':!0}),'import { ChangeEvent, useEffect, useState } from \'react\';\nimport ProductTable, { Product } from \'./ProductTable\';\n\ntype SearchProps = {\n  readonly filterText: string;\n  readonly inStockOnly: boolean;\n  readonly handleFilterTextChange: (e: ChangeEvent<HTMLInputElement>) => void;\n  readonly handleCheckBoxChange: (e: ChangeEvent<HTMLInputElement>) => void;\n};\n\nconst SearchBar = ({\n  filterText,\n  inStockOnly,\n  handleFilterTextChange,\n  handleCheckBoxChange,\n}: SearchProps) => (\n  <form>\n    <input\n      type="text"\n      placeholder="search here"\n      value={filterText}\n      onChange={handleFilterTextChange}\n    />\n    <p>\n      <input\n        type="checkbox"\n        checked={inStockOnly}\n        onChange={handleCheckBoxChange}\n      />\n      Only show the products in stock\n    </p>\n  </form>\n);\n\ntype NewProductProps = {\n  products: Product[];\n  setProducts: React.Dispatch<React.SetStateAction<Product[]>>;\n};\n\nconst NewProduct = ({ products, setProducts }: NewProductProps) => {\n  const [category, setCategory] = useState(\'\');\n  const [price, setPrice] = useState(\'\');\n  const [stocked, setStocked] = useState(true);\n  const [name, setName] = useState(\'\');\n\n  // POST request using fetch\n  const createProduct = () => {\n    const newProduct = {\n      category: category,\n      price: price,\n      stocked: stocked,\n      name: name,\n    };\n    fetch(\'/createProduct\', {\n      method: \'POST\',\n      headers: {\n        \'content-type\': \'application/json\',\n      },\n      body: JSON.stringify(newProduct),\n    })\n      .then((res) => res.text())\n      .then((data) => {\n        const newProductWithID = { ...newProduct, id: data };\n        setProducts([...products, newProductWithID]);\n      });\n  };\n\n  // POST request using axios and async/await\n  // const createProduct = async () => {\n  //   const newProduct = { category, price, stocked, name };\n  //   const { data } = await axios.post<string>(\'/createProduct\', newProduct);\n  //   const newProductWithID = { ...newProduct, id: data };\n  //   setProducts([...products, newProductWithID]);\n  // }\n\n  return (\n    <div>\n      <p>new product</p>\n      <input\n        type="text"\n        name="category"\n        placeholder="category..."\n        value={category}\n        onChange={(e) => setCategory(e.target.value)}\n      />\n      <input\n        type="text"\n        name="price"\n        placeholder="price..."\n        value={price}\n        onChange={(e) => setPrice(e.target.value)}\n      />\n      <select\n        name="stock"\n        onChange={(e) => setStocked(e.target.selectedIndex === 0)}\n      >\n        <option value="true">in stock</option>\n        <option value="false">out of stock</option>\n      </select>\n      <input\n        type="text"\n        name="name"\n        placeholder="name..."\n        value={name}\n        onChange={(e) => setName(e.target.value)}\n      />\n      <button onClick={() => createProduct()}>add a product</button>\n    </div>\n  );\n};\n\nconst FilterableProductTable = () => {\n  const [filterText, setFilterText] = useState(\'\');\n  const [inStockOnly, setInStockOnly] = useState(false);\n  const [products, setProducts] = useState<Product[]>([]);\n\n  // GET request using fetch\n  useEffect(() => {\n    fetch(\'/getProducts\')\n      .then((res) => res.json())\n      .then((data) => {\n        setProducts(data);\n      });\n  }, [products]);\n\n  // GET request using axios and async/await\n  // useEffect(() => {\n  //   const { data } = await axios.get<readonly Product[]>(\'/getProducts\');\n  //   setProducts(data)\n  // }, [products]);\n\n  const handleFilterTextChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setFilterText(e.target.value);\n  };\n\n  const handleCheckBoxChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setInStockOnly(e.target.checked);\n  };\n\n  return (\n    <div>\n      <SearchBar\n        filterText={filterText}\n        inStockOnly={inStockOnly}\n        handleFilterTextChange={handleFilterTextChange}\n        handleCheckBoxChange={handleCheckBoxChange}\n      />\n      <ProductTable\n        products={products}\n        filterText={filterText}\n        inStockOnly={inStockOnly}\n      />\n      <NewProduct products={products} setProducts={setProducts} />\n    </div>\n  );\n};\n\nexport default FilterableProductTable;\n')))}p.isMDXComponent=!0},142:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return h}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),p=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},u=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(n),u=a,h=d["".concat(c,".").concat(u)]||d[u]||b[u]||r;return n?o.a.createElement(h,i(i({ref:t},l),{},{components:n})):o.a.createElement(h,i({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,c=new Array(r);c[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var l=2;l<r;l++)c[l]=n[l];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);