(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{132:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"metadata",(function(){return i})),t.d(n,"rightToc",(function(){return l})),t.d(n,"default",(function(){return p}));var o=t(1),r=t(9),a=(t(0),t(148)),c={id:"lecture3",title:"Lecture 3"},i={id:"lecture3",title:"Lecture 3",description:"## Before the lecture",source:"@site/docs/lecture3.md",permalink:"/docs/lecture3",sidebar:"docs",previous:{title:"Lecture 2",permalink:"/docs/lecture2"},next:{title:"Lecture 4",permalink:"/docs/lecture4"}},l=[{value:"Before the lecture",id:"before-the-lecture",children:[{value:"Install Postman",id:"install-postman",children:[]},{value:"Firebase Setup",id:"firebase-setup",children:[]},{value:"Check your setup",id:"check-your-setup",children:[]}]}],s={rightToc:l};function p(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"before-the-lecture"},"Before the lecture"),Object(a.b)("h3",{id:"install-postman"},"Install Postman"),Object(a.b)("p",null,"Install Postman from ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://www.postman.com/downloads/"}),"https://www.postman.com/downloads/")),Object(a.b)("h3",{id:"firebase-setup"},"Firebase Setup"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Create an account on ",Object(a.b)("a",Object(o.a)({parentName:"li"},{href:"https://firebase.google.com"}),"Firebase"),". You only need the free version."),Object(a.b)("li",{parentName:"ol"},"Go to the database tab in Firebase console. Choose to create ",Object(a.b)("strong",{parentName:"li"},"Firestore")," starting in locked\nmode."),Object(a.b)("li",{parentName:"ol"},"Download the service account in ",Object(a.b)("inlineCode",{parentName:"li"},"Project Settings > Service accounts")," as ",Object(a.b)("inlineCode",{parentName:"li"},"service-account.json"),". ",Object(a.b)("inlineCode",{parentName:"li"},"Project Settings")," can be found by clicking the gear button on the left panel next to ",Object(a.b)("inlineCode",{parentName:"li"},"Project Overview"),". Go to ",Object(a.b)("inlineCode",{parentName:"li"},"Service accounts")," tab and click the ",Object(a.b)("inlineCode",{parentName:"li"},"Generate new private key button"),". Save the downloaded file as ",Object(a.b)("inlineCode",{parentName:"li"},"service-account.json"),"\nThis json should be kept secret.")),Object(a.b)("h3",{id:"check-your-setup"},"Check your setup"),Object(a.b)("h4",{id:"code"},"Code"),Object(a.b)("p",null,"Create a folder with empty ",Object(a.b)("inlineCode",{parentName:"p"},"package.json")," and empty ",Object(a.b)("inlineCode",{parentName:"p"},"index.js"),". Put the downloaded\n",Object(a.b)("inlineCode",{parentName:"p"},"service-account.json")," in this folder."),Object(a.b)("p",null,"Copy the following code into ",Object(a.b)("inlineCode",{parentName:"p"},"package.json"),"."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'{\n  "name": "self-check",\n  "version": "0.1.0",\n  "main": "index.js",\n  "license": "MIT",\n  "dependencies": {\n    "body-parser": "^1.18.3",\n    "express": "^4.16.4",\n    "firebase-admin": "^7.2.0"\n  }\n}\n')),Object(a.b)("p",null,"Copy the following code into ",Object(a.b)("inlineCode",{parentName:"p"},"index.js"),". Remember to replace ",Object(a.b)("inlineCode",{parentName:"p"},"databaseURL")," with\nthe url of your own. You can find this ",Object(a.b)("inlineCode",{parentName:"p"},"databaseURL")," in the code snippet in the service accounts tab of Firebase."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-javascript"}),"const admin = require('firebase-admin');\nconst serviceAccount = require('./service-account.json');\nconst express = require('express');\nconst bodyParser = require('body-parser');\n\nadmin.initializeApp({\n  credential: admin.credential.cert(serviceAccount),\n  databaseURL: '[YOUR_OWN_DATABASE_URL]'\n});\n\nconst db = admin.firestore();\n\nconst app = express();\nconst port = 8080;\napp.use(bodyParser.json());\n\napp.get('/', (_, resp) => resp.send('Hello World!'));\n\napp.get('/self-check', async (_, resp) => {\n  const data = {\n    name: 'Hello World',\n    time: admin.firestore.FieldValue.serverTimestamp()\n  };\n  console.log('Sending doc to DB.');\n  await db\n    .collection('test')\n    .doc('random-id')\n    .set(data);\n  console.log('Doc recorded in DB');\n  const docRef = db.collection('test').doc('random-id');\n  console.log('Trying to obtain doc in DB.');\n  const docSnapshot = await docRef.get();\n  console.log(\n    `We obtained a doc with id ${docSnapshot.id}. It's content is logged below:`\n  );\n  console.log(docSnapshot.data());\n  console.log('Now we will try to remove it.');\n  await docRef.delete();\n  console.log('The document is deleted.');\n  console.log(\n    'After all these operations, the db should be empty. We check that.'\n  );\n  db.collection('test')\n    .get()\n    .then(querySnapshot => {\n      if (querySnapshot.docs.length === 0) {\n        console.log('We passed the check. The page in browser should say OK.');\n        resp.status(200).send('OK.');\n      } else {\n        console.log('We failed the check. Please check your setup.');\n        resp.status(500).send('Something is messed up!');\n      }\n    });\n});\n\napp.listen(port, () => console.log(`Example app listening on port ${port}!`));\n")),Object(a.b)("h4",{id:"verify-that-it-works"},"Verify that it works"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Run ",Object(a.b)("inlineCode",{parentName:"li"},"yarn install"),";"),Object(a.b)("li",{parentName:"ol"},"Run ",Object(a.b)("inlineCode",{parentName:"li"},"node index.js"),";"),Object(a.b)("li",{parentName:"ol"},"Open ",Object(a.b)("a",Object(o.a)({parentName:"li"},{href:"http://localhost:8080"}),Object(a.b)("inlineCode",{parentName:"a"},"http://localhost:8080")),". You will see\n",Object(a.b)("inlineCode",{parentName:"li"},"Hello World!"),";"),Object(a.b)("li",{parentName:"ol"},"Open ",Object(a.b)("a",Object(o.a)({parentName:"li"},{href:"http://localhost:8080/self-check"}),Object(a.b)("inlineCode",{parentName:"a"},"http://localhost:8080/self-check")),".\nYou will see ",Object(a.b)("inlineCode",{parentName:"li"},"OK!")," in the browser. In the terminal, you will see something\nlike this:")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-text"}),"Example app listening on port 8080!\nSending doc to DB.\nDoc recorded in DB\nTrying to obtain doc in DB.\nWe obtained a doc with id random-id. It's content is logged below:\n{ name: 'Hello World',\n  time: Timestamp { _seconds: 1554738493, _nanoseconds: 994000000 } }\nNow we will try to remove it.\nThe document is deleted.\nAfter all these operations, the db should be empty. We check that.\nWe passed the check. The page in browser should say OK.\n")))}p.isMDXComponent=!0},148:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return m}));var o=t(0),r=t.n(o);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=r.a.createContext({}),p=function(e){var n=r.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i({},n,{},e)),t},d=function(e){var n=p(e.components);return r.a.createElement(s.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},u=Object(o.forwardRef)((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=p(t),u=o,m=d["".concat(c,".").concat(u)]||d[u]||b[u]||a;return t?r.a.createElement(m,i({ref:n},s,{components:t})):r.a.createElement(m,i({ref:n},s))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,c=new Array(a);c[0]=u;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,c[1]=i;for(var s=2;s<a;s++)c[s]=t[s];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);